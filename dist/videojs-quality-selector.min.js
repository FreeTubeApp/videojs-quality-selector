!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("video.js")):"function"==typeof define&&define.amd?define(["exports","video.js"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["videojs-quality-selector"]={},e.videojs)}(this,function(e,t){"use strict";class a{constructor(e,t){this._player=e,this._seekToTime=t,this._hasFinished=!1,this._keepThisInstanceWhenPlayerSourcesChange=!1,this._seekWhenSafe()}_seekWhenSafe(){this._player.readyState()<3?(this._seekFn=this._seek.bind(this),this._player.one("canplay",this._seekFn)):this._seek()}onPlayerSourcesChange(){this._keepThisInstanceWhenPlayerSourcesChange?this._keepThisInstanceWhenPlayerSourcesChange=!1:this.cancel()}onQualitySelectionChange(){this.hasFinished()||(this._keepThisInstanceWhenPlayerSourcesChange=!0)}_seek(){this._player.currentTime(this._seekToTime),this._keepThisInstanceWhenPlayerSourcesChange=!1,this._hasFinished=!0}hasFinished(){return this._hasFinished}cancel(){this._player.off("canplay",this._seekFn),this._keepThisInstanceWhenPlayerSourcesChange=!1,this._hasFinished=!0}}const n={QUALITY_REQUESTED:"qualityRequested",QUALITY_SELECTED:"qualitySelected",PLAYER_SOURCES_CHANGED:"playerSourcesChanged"};class i extends t.getComponent("MenuItem"){constructor(e,t){var s=t.source;if("object"!=typeof s||!s)throw new TypeError('was not provided a "source" object, but rather: '+typeof s);super(e,t=Object.assign({selectable:!0,label:s.label},t)),this.source=s}handleClick(e){super.handleClick(e),this.player().trigger(n.QUALITY_REQUESTED,this.source)}}const r="vjs-quality-changing";class o extends t.getComponent("MenuButton"){constructor(s,e){super(s,e),s.on(n.QUALITY_REQUESTED,function(e,t){this.setSelectedSource(t),s.addClass(r),s.one("loadeddata",function(){s.removeClass(r)})}.bind(this)),s.on(n.PLAYER_SOURCES_CHANGED,function(){this.update()}.bind(this)),s.on(n.QUALITY_SELECTED,function(e,t){this.setSelectedSource(t)}.bind(this)),s.one("ready",function(){this.selectedSrc=s.src(),this.update()}.bind(this)),this.controlText("Open quality selector menu")}setSelectedSource(e){var t=e?e.src:void 0;if(this.selectedSrc!==t){this.selectedSrc=t;for(const s of this.items)s.selected(s.source.src===t)}}createItems(){var t=this.player(),e=t.currentSources();return!e||e.length<2?[]:e.map(function(e){return new i(t,{source:e,selected:e.src===this.selectedSrc})}.bind(this))}buildWrapperCSSClass(){return"vjs-quality-selector "+super.buildWrapperCSSClass()}}t.registerComponent("QualitySelector",o);class c{constructor(e){this.player=e,this.begin()}begin(){this.player.use("*",function(i){return{setSource:function(e,t){var s=i.currentSources();i._qualitySelectorSafeSeek&&i._qualitySelectorSafeSeek.onPlayerSourcesChange(),JSON.stringify(s)!=JSON.stringify(i._qualitySelectorPreviousSources)&&(i.trigger(n.PLAYER_SOURCES_CHANGED,s),i._qualitySelectorPreviousSources=s),s=s.find(function(e){return!0===e.selected||"true"===e.selected||"selected"===e.selected})||e,i.trigger(n.QUALITY_SELECTED,s),t(void 0,s)}}})}}class s extends t.getPlugin("plugin"){constructor(e,t){super(e,s.obj.merge({},t)),s.registerComponent("QualitySelector",o),s.registerComponent("QualityOption",i),this.intercept=new c(e);const s=e||window.videojs;s.hook("setup",function(c){c.on(n.QUALITY_REQUESTED,function(e,t){var s=c.currentSources();let i=c.currentTime(),n=c.playbackRate(),r=c.paused();for(const o of s)o.selected=!1;s.find(e=>e==t.src).selected=!0,c._qualitySelectorSafeSeek&&c._qualitySelectorSafeSeek.onQualitySelectionChange(),c.src(s),c.ready(function(){c._qualitySelectorSafeSeek&&!c._qualitySelectorSafeSeek.hasFinished()||(c._qualitySelectorSafeSeek=new a(c,i),c.playbackRate(n)),r||c.play()})})})}}e.QualitySelectorPlugin=s});
//# sourceMappingURL=videojs-quality-selector.min.js